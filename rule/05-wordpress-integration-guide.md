# WordPress記事連携完全ガイド

このドキュメントでは、BasketTalk JapanプロジェクトにおけるWordPressでの記事管理とNext.jsアプリとの連携方法を、初心者向けに詳しく説明します。

## 目次

1. [概要とアーキテクチャ](#概要とアーキテクチャ)
2. [WordPressとは？](#wordpressとは)
3. [Swellテーマについて](#swellテーマについて)
4. [WordPressのセットアップ](#wordpressのセットアップ)
5. [WordPress REST APIの設定](#wordpress-rest-apiの設定)
6. [記事の作成方法](#記事の作成方法)
7. [Next.jsとの連携](#nextjsとの連携)
8. [SEO最適化](#seo最適化)
9. [トラブルシューティング](#トラブルシューティング)
10. [よくある質問](#よくある質問)

---

## 概要とアーキテクチャ

### なぜWordPressを使うのか？

BasketTalk Japanでは、以下の理由からWordPressで記事を管理します：

1. **SEO最適化が容易**
   - WordPressのSEOプラグイン（Yoast SEO、Rank Mathなど）が利用可能
   - 記事の構造化データが自動生成
   - サイトマップの自動生成

2. **非技術者でも記事管理が可能**
   - リッチエディタ（Gutenberg）で直感的に記事を作成
   - メディアライブラリで画像を簡単に管理
   - カテゴリー・タグで記事を整理

3. **既存のWordPressエコシステムを活用**
   - 豊富なプラグイン
   - 多くのテーマ
   - 充実したドキュメント

### システム構成

```
┌─────────────────────────────────────┐
│   WordPress (有料サーバー)          │
│   - 記事管理                         │
│   - SEO最適化                        │
│   - コンテンツ管理                   │
│   - メディアライブラリ               │
└──────────────┬──────────────────────┘
               │ WordPress REST API
               │ (HTTP通信)
               ↓
┌─────────────────────────────────────┐
│   Next.js App (Vercel/有料サーバー) │
│   - コミュニティ機能                 │
│   - スレッド・投稿                   │
│   - 認証・ユーザー管理               │
│   - WordPress記事の表示              │
└─────────────────────────────────────┘
```

**重要なポイント**:
- WordPressとNext.jsは**別々のサーバー**で動作
- WordPress REST APIで**HTTP通信**を行い、記事データを取得
- WordPressで記事を公開すると、自動的にNext.jsアプリに反映

---

## WordPressとは？

### WordPressの基本

WordPressは、世界で最も使われているコンテンツ管理システム（CMS）です。

**特徴**:
- **無料で利用可能**（オープンソース）
- **プラグインとテーマが豊富**
- **初心者でも使いやすい**
- **SEOに強い**

### WordPressの2つの種類

1. **WordPress.com**: ホスティングサービス（有料プランあり）
2. **WordPress.org**: 自分でサーバーにインストール（今回使用）

今回は**WordPress.org**を使用します。

### WordPressの主な機能

- **投稿（Posts）**: ブログ記事やニュース記事
- **固定ページ（Pages）**: 会社概要、お問い合わせなど
- **メディアライブラリ**: 画像・動画の管理
- **カテゴリー・タグ**: 記事の分類
- **プラグイン**: 機能拡張
- **テーマ**: デザインの変更

---

## Swellテーマについて

### Swellとは？

**Swell**は、日本のWordPressテーマです。高機能で使いやすく、SEOにも強いテーマです。

### Swellを使うメリット

1. **記事作成が簡単**
   - 直感的なブロックエディタ
   - 豊富なブロック（見出し、画像、リストなど）
   - レスポンシブデザイン対応

2. **SEO最適化**
   - 構造化データの自動生成
   - メタタグの自動設定
   - サイトマップの自動生成

3. **デザインが美しい**
   - モダンなデザイン
   - カスタマイズが容易
   - レスポンシブ対応

### Swellを使わない場合

Swellは**有料テーマ**（約1万円程度）ですが、**必須ではありません**。

**代替案**:
- **無料テーマ**: Twenty Twenty-Four（WordPress標準テーマ）
- **その他の有料テーマ**: Cocoon、THE THORなど

**注意**: Swellを使わなくても、WordPress REST APIは標準機能なので、Next.jsとの連携は可能です。

### Swellの購入方法（使う場合）

1. [Swell公式サイト](https://swell-theme.com/)にアクセス
2. 購入ページでライセンスを購入
3. ZIPファイルをダウンロード
4. WordPressにアップロード（後述）

---

## WordPressのセットアップ

### ステップ1: サーバーの準備

WordPressをインストールするには、以下のいずれかが必要です：

#### オプションA: 有料サーバー（本番環境）

**推奨サーバー**:
- **ConoHa VPS**: 月額500円〜
- **さくらのVPS**: 月額500円〜
- **AWS Lightsail**: 月額500円〜
- **ロリポップ**: 月額250円〜（共有サーバー）

**必要なもの**:
- PHP 7.4以上
- MySQL 5.7以上
- ApacheまたはNginx

#### オプションB: ローカル環境（開発・テスト用）

**Windowsの場合**:
- **Local by Flywheel**（推奨）
- **XAMPP**
- **MAMP**

**Macの場合**:
- **Local by Flywheel**（推奨）
- **MAMP**

### ステップ2: WordPressのインストール

#### 有料サーバーの場合

1. **サーバーにSSH接続**
   ```bash
   ssh username@your-server-ip
   ```

2. **WordPressをダウンロード**
   ```bash
   cd /var/www/html
   wget https://ja.wordpress.org/latest-ja.tar.gz
   tar -xzf latest-ja.tar.gz
   mv wordpress/* .
   ```

3. **データベースの作成**
   - サーバーの管理画面（cPanel、Pleskなど）からMySQLデータベースを作成
   - データベース名、ユーザー名、パスワードをメモ

4. **WordPressの設定**
   - ブラウザで `http://your-server-ip/wp-admin/install.php` にアクセス
   - データベース情報を入力
   - サイト名、管理者情報を設定

#### ローカル環境（Local by Flywheel）の場合

1. **Local by Flywheelをダウンロード**
   - [公式サイト](https://localwp.com/)からダウンロード
   - インストール

2. **新規サイトを作成**
   - Localを起動
   - 「Create a New Site」をクリック
   - サイト名を入力（例: `baskettalk-articles`）
   - 環境設定はデフォルトでOK
   - 「Add Site」をクリック

3. **サイトを起動**
   - 作成したサイトを選択
   - 「Start Site」をクリック
   - 「Admin」ボタンをクリックして管理画面にアクセス

### ステップ3: 初期設定

1. **言語設定**
   - 管理画面 → 設定 → 一般
   - サイトの言語: 日本語

2. **パーマリンク設定**（重要！）
   - 管理画面 → 設定 → パーマリンク
   - 「投稿名」を選択
   - 「変更を保存」をクリック

   **理由**: REST APIで記事を取得する際、スラッグ（URL）を使用するため

3. **タイムゾーン設定**
   - 管理画面 → 設定 → 一般
   - タイムゾーン: `(UTC+9) 東京`

### ステップ4: テーマのインストール

#### Swellを使う場合

1. **Swellをダウンロード**
   - 購入したZIPファイルを解凍

2. **テーマをアップロード**
   - 管理画面 → 外観 → テーマ
   - 「新規追加」をクリック
   - 「テーマのアップロード」をクリック
   - ZIPファイルを選択
   - 「今すぐインストール」をクリック

3. **テーマを有効化**
   - インストール完了後、「有効化」をクリック

#### 無料テーマを使う場合

1. **Twenty Twenty-Fourを有効化**
   - 管理画面 → 外観 → テーマ
   - 「Twenty Twenty-Four」を選択
   - 「有効化」をクリック

---

## WordPress REST APIの設定

### REST APIとは？

WordPress REST APIは、WordPressのデータを外部アプリケーション（Next.jsなど）から取得するための仕組みです。

**例**:
```
https://your-wordpress-site.com/wp-json/wp/v2/posts
```
このURLにアクセスすると、記事一覧がJSON形式で返ってきます。

### ステップ1: REST APIが有効か確認

1. **ブラウザで確認**
   - `https://your-wordpress-site.com/wp-json/wp/v2/posts` にアクセス
   - JSONデータが表示されればOK

2. **エラーが出る場合**
   - パーマリンク設定を確認（「投稿名」を選択）
   - `.htaccess`ファイルの権限を確認

### ステップ2: CORS設定（必要に応じて）

Next.jsアプリとWordPressが異なるドメインの場合、CORS設定が必要です。

#### 方法1: プラグインを使用（推奨）

1. **「REST API - Filter Fields」プラグインをインストール**
   - 管理画面 → プラグイン → 新規追加
   - 「REST API - Filter Fields」を検索
   - 「今すぐインストール」→「有効化」

2. **または「WP REST API Controller」プラグイン**
   - 同様にインストール・有効化

#### 方法2: `.htaccess`で設定

WordPressのルートディレクトリにある`.htaccess`に以下を追加：

```apache
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
</IfModule>
```

**注意**: `*`はすべてのドメインを許可します。本番環境では、Next.jsアプリのドメインのみを許可することを推奨します。

### ステップ3: API URLの確認

WordPress REST APIのベースURLは以下の形式です：

```
https://your-wordpress-site.com/wp-json/wp/v2
```

**主要なエンドポイント**:
- `/posts`: 記事一覧
- `/posts/{id}`: 記事詳細
- `/categories`: カテゴリー一覧
- `/tags`: タグ一覧

---

## 記事の作成方法

### ステップ1: 新規投稿を作成

1. **管理画面にログイン**
   - `https://your-wordpress-site.com/wp-admin`

2. **新規投稿を作成**
   - 左メニュー → 「投稿」→「新規追加」

### ステップ2: タイトルと本文を入力

1. **タイトルを入力**
   - 上部の「タイトルを追加」に記事のタイトルを入力

2. **本文を入力**
   - ブロックエディタ（Gutenberg）を使用
   - 「+」ボタンでブロックを追加
     - **段落**: 通常のテキスト
     - **見出し**: H2、H3など
     - **画像**: 画像を挿入
     - **リスト**: 箇条書き
     - **引用**: 引用文

### ステップ3: カテゴリーとタグを設定

1. **カテゴリーを設定**
   - 右サイドバー → 「カテゴリー」
   - 既存のカテゴリーを選択、または新規作成
   - 例: 「試合レポート」「選手情報」「チーム情報」

2. **タグを設定**
   - 右サイドバー → 「タグ」
   - 関連するタグを追加
   - 例: 「レイカーズ」「カリー」「プレーオフ」

### ステップ4: アイキャッチ画像を設定

1. **アイキャッチ画像を設定**
   - 右サイドバー → 「アイキャッチ画像」
   - 「アイキャッチ画像を設定」をクリック
   - 画像をアップロードまたは選択

**推奨サイズ**: 1200×630px（OGP画像として使用）

### ステップ5: 公開設定

1. **公開状態を確認**
   - 右サイドバー → 「公開」
   - 「公開」をクリックして記事を公開

2. **公開日時を設定**（必要に応じて）
   - 「すぐに公開」をクリック
   - 日時を設定

### ステップ6: プレビューで確認

1. **プレビューを表示**
   - 右上の「プレビュー」ボタンをクリック
   - 記事の見た目を確認

### 記事作成のベストプラクティス

1. **タイトルは具体的に**
   - ❌ 「試合結果」
   - ✅ 「レイカーズ vs ウォリアーズ 試合結果 - カリーが40得点で勝利」

2. **見出しを適切に使用**
   - H2: 大見出し
   - H3: 中見出し
   - H4: 小見出し

3. **画像にはalt属性を設定**
   - アクセシビリティとSEOのため

4. **内部リンクを追加**
   - 関連記事へのリンク
   - チームページへのリンク

---

## Next.jsとの連携

### ステップ1: 環境変数の設定

`.env.local`ファイルにWordPressのURLを追加：

```env
NEXT_PUBLIC_WORDPRESS_API_URL=https://your-wordpress-site.com
```

**重要**: 
- `NEXT_PUBLIC_`で始まる必要がある（クライアント側で使用するため）
- 末尾に`/wp-json`は不要（コード内で自動的に追加）

### ステップ2: APIクライアントの確認

`lib/wordpress/api.ts`が正しく設定されているか確認：

```typescript
const WORDPRESS_API_URL = process.env.NEXT_PUBLIC_WORDPRESS_API_URL || '';
```

### ステップ3: 記事一覧ページの確認

`app/articles/page.tsx`で記事一覧が表示されるか確認：

1. **開発サーバーを起動**
   ```bash
   npm run dev
   ```

2. **ブラウザで確認**
   - `http://localhost:3000/articles` にアクセス
   - WordPressの記事が表示されればOK

### ステップ4: 記事詳細ページの確認

1. **記事詳細ページにアクセス**
   - 記事一覧から記事をクリック
   - `http://localhost:3000/articles/記事のスラッグ` にアクセス

2. **表示を確認**
   - タイトル、本文、画像が正しく表示されるか確認

### ステップ5: キャッシュ設定

Next.jsでは、ISR（Incremental Static Regeneration）を使用して記事をキャッシュします。

**現在の設定**:
- 記事一覧: 30分ごとに再生成
- 記事詳細: 1時間ごとに再生成

**変更する場合**:
`lib/wordpress/api.ts`の`revalidate`値を変更：

```typescript
{
  next: { revalidate: 1800 }, // 秒単位（1800 = 30分）
}
```

---

## SEO最適化

### ステップ1: SEOプラグインのインストール

#### Yoast SEO（推奨）

1. **Yoast SEOをインストール**
   - 管理画面 → プラグイン → 新規追加
   - 「Yoast SEO」を検索
   - 「今すぐインストール」→「有効化」

2. **初期設定**
   - 左メニュー → 「SEO」→「一般」
   - ウィザードに従って設定

#### Rank Math（代替案）

1. **Rank Mathをインストール**
   - 同様にインストール・有効化

### ステップ2: 記事ごとのSEO設定

1. **記事編集画面で設定**
   - 記事編集画面の下部に「Yoast SEO」セクションが表示
   - **フォーカスキーワード**: 記事の主要キーワード
   - **メタディスクリプション**: 検索結果に表示される説明文

2. **プレビューを確認**
   - 「Googleプレビュー」で検索結果の見た目を確認

### ステップ3: サイトマップの設定

1. **サイトマップを有効化**
   - Yoast SEO → 一般 → 機能
   - 「XMLサイトマップ」を有効化

2. **サイトマップのURLを確認**
   - `https://your-wordpress-site.com/sitemap_index.xml`

3. **Google Search Consoleに登録**
   - [Google Search Console](https://search.google.com/search-console)にアクセス
   - サイトマップを送信

### ステップ4: 構造化データの確認

WordPressとYoast SEOで、構造化データ（JSON-LD）が自動生成されます。

**確認方法**:
1. [Google構造化データテストツール](https://search.google.com/test/rich-results)にアクセス
2. 記事のURLを入力
3. 構造化データが正しく認識されているか確認

---

## トラブルシューティング

### 問題1: REST APIにアクセスできない

**症状**: `wp-json/wp/v2/posts`にアクセスしてもエラーが出る

**解決方法**:
1. パーマリンク設定を確認（「投稿名」を選択）
2. `.htaccess`ファイルの権限を確認（644）
3. サーバーのmod_rewriteが有効か確認

### 問題2: CORSエラーが出る

**症状**: ブラウザのコンソールにCORSエラーが表示される

**解決方法**:
1. CORS設定を確認（前述の手順を参照）
2. Next.jsアプリとWordPressのドメインを確認
3. `.htaccess`またはプラグインでCORSを設定

### 問題3: 記事が表示されない

**症状**: Next.jsアプリで記事が表示されない

**解決方法**:
1. 環境変数`NEXT_PUBLIC_WORDPRESS_API_URL`が正しく設定されているか確認
2. WordPressの記事が「公開」状態か確認
3. ブラウザのコンソールでエラーを確認
4. `lib/wordpress/api.ts`のエラーハンドリングを確認

### 問題4: 画像が表示されない

**症状**: 記事の画像が表示されない

**解決方法**:
1. WordPressのメディアライブラリで画像が正しくアップロードされているか確認
2. 画像のURLが正しいか確認
3. Next.jsの`next.config.ts`で画像ドメインを許可：

```typescript
images: {
  domains: ['your-wordpress-site.com'],
},
```

### 問題5: 記事の更新が反映されない

**症状**: WordPressで記事を更新しても、Next.jsアプリに反映されない

**解決方法**:
1. キャッシュをクリア（Next.jsの再ビルド）
2. `revalidate`の値を小さくする（例: 300秒 = 5分）
3. 手動で再生成する場合は、Vercelのダッシュボードから再デプロイ

---

## よくある質問

### Q1: Swellは必須ですか？

**A**: いいえ、必須ではありません。WordPress REST APIは標準機能なので、どのテーマでも使用できます。ただし、Swellは記事作成が簡単で、SEOにも強いため、おすすめです。

### Q2: WordPressとNext.jsは同じサーバーに置く必要がありますか？

**A**: いいえ、別々のサーバーでも問題ありません。REST APIでHTTP通信を行うため、どこにあっても連携できます。

### Q3: 記事を公開すると、すぐにNext.jsアプリに反映されますか？

**A**: キャッシュの設定によります。現在の設定では、記事一覧は30分、記事詳細は1時間ごとに再生成されます。すぐに反映させたい場合は、`revalidate`の値を小さくするか、手動で再デプロイしてください。

### Q4: WordPressの管理画面にアクセスできない

**A**: 
1. URLが正しいか確認（`/wp-admin`）
2. ユーザー名・パスワードが正しいか確認
3. サーバーの設定を確認

### Q5: 記事のスラッグ（URL）を変更したい

**A**: 
1. 記事編集画面 → 右サイドバー → 「パーマリンク」
2. 「編集」をクリック
3. スラッグを変更
4. 「OK」をクリック

### Q6: カテゴリーやタグを追加したい

**A**: 
1. 管理画面 → 「投稿」→「カテゴリー」（または「タグ」）
2. 名前、スラッグを入力
3. 「新規カテゴリーを追加」をクリック

### Q7: メディアライブラリに画像をアップロードする方法

**A**: 
1. 管理画面 → 「メディア」→「新規追加」
2. 画像をドラッグ&ドロップ、または「ファイルを選択」
3. アップロード完了後、記事編集画面で使用可能

### Q8: 記事を下書き保存する方法

**A**: 
1. 記事編集画面で「下書きとして保存」をクリック
2. 公開するまで、Next.jsアプリには表示されません

### Q9: 複数の著者で記事を管理したい

**A**: 
1. 管理画面 → 「ユーザー」→「新規追加」
2. ユーザー名、メールアドレス、パスワードを設定
3. 権限グループ: 「投稿者」または「編集者」を選択
4. 各ユーザーでログインして記事を作成

### Q10: WordPressのバックアップは必要ですか？

**A**: はい、定期的にバックアップを取ることをおすすめします。

**方法**:
1. **プラグインを使用**: 「UpdraftPlus」など
2. **手動でバックアップ**: 
   - データベースをエクスポート
   - `wp-content`フォルダをコピー

---

## まとめ

WordPressでの記事管理は、以下の手順で行います：

1. ✅ WordPressをセットアップ
2. ✅ REST APIを有効化
3. ✅ 記事を作成・公開
4. ✅ Next.jsアプリで記事を表示
5. ✅ SEO最適化

**重要なポイント**:
- WordPressとNext.jsは別々のサーバーで動作
- REST APIでHTTP通信を行う
- 記事を公開すると、自動的にNext.jsアプリに反映（キャッシュの設定による）

**次のステップ**:
1. WordPressをセットアップ
2. テスト記事を1つ作成
3. Next.jsアプリで表示を確認
4. SEOプラグインを設定
5. 本格的に記事を作成

不明な点があれば、必ず確認してから作業を進めてください。

