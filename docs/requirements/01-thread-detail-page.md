# 要件定義書：スレッド詳細ページ

**優先順位**: 1  
**作成日**: 2025-11-23  
**ステータス**: 未着手

## 概要

スレッドの詳細を表示し、投稿・返信ができるページ

## URL

`/community/thread/[id]`

## 機能要件

### 1. スレッド情報の表示

- [ ] スレッドタイトル
- [ ] 作成者情報（表示名、アバター）
- [ ] 作成日時（相対時間表示：例「3時間前」）
- [ ] スレッドタイプ（試合スレ/チーム掲示板/自由スレ）
- [ ] タグ一覧
- [ ] いいね数
- [ ] コメント数
- [ ] 固定スレッドの場合は「固定」バッジ

### 2. 試合スレッドの場合

- [ ] 試合情報の表示
  - 対戦カード（ホーム vs アウェイ）
  - 試合日時
  - 試合ステータス（予定/生放送中/終了）
  - スコア（終了時）
  - BoxScoreへのリンク（あれば）

### 3. チーム掲示板の場合

- [ ] チーム情報の表示
  - チーム名
  - チーム略称
  - リージョン（East/West）

### 4. 投稿一覧の表示

- [ ] 投稿を時系列で表示（古い順）
- [ ] 各投稿に以下を表示：
  - 作成者情報（表示名、アバター）
  - 投稿内容
  - 作成日時（相対時間）
  - 編集日時（編集されている場合）
  - いいね数
  - いいねボタン（ログイン済みユーザーのみ）
  - 返信ボタン（ログイン済みユーザーのみ）
  - 通報ボタン（ログイン済みユーザーのみ）
- [ ] 返信の階層表示（親投稿への返信をインデント表示）
- [ ] 削除された投稿は「この投稿は削除されました」と表示

### 5. 投稿フォーム

- [ ] ログイン済みユーザーのみ表示
- [ ] テキストエリア（本文入力）
- [ ] プレビュー機能（オプション）
- [ ] 投稿ボタン
- [ ] キャンセルボタン（返信の場合）

### 6. 返信機能

- [ ] 返信ボタンをクリックで返信フォームを表示
- [ ] 返信先の投稿を引用表示
- [ ] 返信フォームから投稿可能
- [ ] 返信の階層構造を保持

### 7. いいね機能

- [ ] いいねボタン（ハートアイコン）
- [ ] いいね済みの場合は色が変わる
- [ ] いいね数の表示
- [ ] クリックでいいね/いいね解除を切り替え
- [ ] ログイン済みユーザーのみ操作可能

### 8. 通報機能

- [ ] 通報ボタン（フラグアイコン）
- [ ] 通報理由の選択
  - スパム
  - 不適切な内容
  - ハラスメント
  - その他
- [ ] 通報理由の詳細入力（任意）
- [ ] 通報送信ボタン

### 9. ナビゲーション

- [ ] コミュニティに戻るリンク
- [ ] チーム掲示板の場合はチームページへのリンク
- [ ] 試合スレッドの場合は試合情報へのリンク

## UI要件

### レイアウト

- ヘッダー：スレッドタイトル、メタ情報
- メインコンテンツ：投稿一覧
- サイドバー（オプション）：関連スレッド、関連記事
- フッター：投稿フォーム（固定表示）

### レスポンシブデザイン

- モバイルファースト
- タブレット・デスクトップでも適切に表示

### アクセシビリティ

- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切なコントラスト比

## データ要件

### 必要なデータ

- スレッド情報（Thread）
- 投稿一覧（Post[]）
- ユーザー情報（User[]）
- いいね情報（Like[]）
- 試合情報（Match、試合スレッドの場合）
- チーム情報（Team、チーム掲示板の場合）

### API/関数

- `getThread(threadId)` - スレッド取得
- `getPostsByThread(threadId)` - 投稿一覧取得
- `createPost(postData)` - 投稿作成
- `toggleLike(userId, postId)` - いいね切り替え
- `createReport(reportData)` - 通報作成
- `getMatch(matchId)` - 試合情報取得（試合スレッドの場合）
- `getTeam(teamId)` - チーム情報取得（チーム掲示板の場合）

## 非機能要件

### パフォーマンス

- 初期表示: < 2秒
- 投稿追加: < 1秒
- いいね切り替え: < 500ms

### セキュリティ

- 認証チェック（投稿・いいね・通報）
- XSS対策（サニタイズ）
- CSRF対策

### エラーハンドリング

- スレッドが存在しない場合：404ページ
- 権限がない場合：適切なエラーメッセージ
- ネットワークエラー：リトライ機能

## 実装チェックリスト

### フェーズ1: 基本表示
- [ ] スレッド情報の表示
- [ ] 投稿一覧の表示
- [ ] ローディング状態
- [ ] エラーハンドリング

### フェーズ2: 投稿機能
- [x] 投稿フォーム
- [x] 投稿作成
- [x] 投稿後の更新

### フェーズ3: 返信機能
- [x] 返信機能は不要（スキップ）

### フェーズ4: いいね機能
- [x] いいねボタン
- [x] いいね切り替え
- [x] いいね数の更新

### フェーズ5: 通報機能
- [x] 通報ボタン
- [x] 通報フォーム
- [x] 通報送信

### フェーズ6: 試合・チーム情報
- [x] 試合情報の表示（試合スレッド）
- [x] チーム情報の表示（チーム掲示板）

## 参考

- 要件定義書 v0.2
- 画面遷移図
- データモデル

