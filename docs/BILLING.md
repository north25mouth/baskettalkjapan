# Firebase 課金・予算管理ガイド

Firebase（Firestore）の課金設定、予算管理、安全対策をまとめたガイドです。

## 📋 目次

1. [請求先情報の登録](#請求先情報の登録)
2. [無料枠について](#無料枠について)
3. [予算アラート・使用量制限の設定](#予算アラート使用量制限の設定)
4. [課金を防ぐための対策](#課金を防ぐための対策)
5. [よくある質問](#よくある質問)

## 請求先情報の登録

### なぜ必要になったのか？

**2020年以降**、Google Cloudのポリシー変更により、**Firestore Databaseを作成する際に請求先情報の登録が必須**になりました。

**理由:**
- 無料枠を超えた場合の課金を明確にするため
- 予想外の課金を防ぐため（予算アラートの設定を推奨）
- サービス利用の透明性を高めるため

**重要なポイント:**
- **請求先情報を登録しても、無料枠内であれば一切課金されません**
- 無料枠を超えた場合のみ、超過分に対して課金されます
- 予算アラートや使用量制限を設定することで、予想外の課金を防げます

### 登録手順

1. **エラーメッセージのリンクをクリック**
   - または、直接アクセス: [請求を有効化](https://console.developers.google.com/billing/enable?project=baskettalkjapan)

2. **Google Cloud Consoleにログイン**
   - Firebaseプロジェクトと同じGoogleアカウントでログイン

3. **請求先アカウントを作成**
   - 「請求先アカウントを作成」をクリック
   - または、既存の請求先アカウントを選択

4. **請求先情報を入力**
   - **国/地域**: 日本を選択
   - **請求先名**: 個人名または組織名を入力
   - **住所**: 請求先の住所を入力
   - **クレジットカード情報**: カード情報を入力
     - ⚠️ **重要**: 無料枠内であれば課金されません

5. **送信して有効化**
   - 「送信して有効化」をクリック
   - 請求先情報の登録が完了します

### 反映を待つ

請求先情報の登録後、**数分（通常2-5分）**待ってから再試行してください。

## 無料枠について

### Firestoreの無料枠（Spark プラン）

Firestoreには**無料枠**があり、以下の範囲内であれば**完全に無料**です：

| 項目 | 無料枠 |
|------|--------|
| ストレージ | 1GB |
| 読み取り | 50,000回/日 |
| 書き込み | 20,000回/日 |
| 削除 | 20,000回/日 |
| ネットワーク送信 | 10GB/月 |

**開発・テスト段階では、通常この無料枠で十分です。**

### ⚠️ 重要なポイント

**無料枠内であれば、一切課金されません。**

請求先情報を登録しても、無料枠内であれば**勝手に課金されることはありません**。

### 無料枠を超えた場合

無料枠を超えた場合のみ、従量課金が発生します：

- ストレージ: $0.18/GB/月（1GB超えた分）
- 読み取り: $0.06/100,000回（50,000回/日超えた分）
- 書き込み: $0.18/100,000回（20,000回/日超えた分）

**例：**
- ストレージが1.5GBの場合: (1.5 - 1.0) × $0.18 = **$0.09/月**
- 1日に60,000回読み取った場合: (60,000 - 50,000) / 100,000 × $0.06 = **$0.006/日**

詳細: [Firestore 料金](https://firebase.google.com/pricing?hl=ja)

## 予算アラート・使用量制限の設定

### ⚠️ 必ず設定してください

無料枠を超えた場合、自動的に課金されるため、以下の対策を**必ず設定してください**。

### ステップ1: Google Cloud Consoleにアクセス

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. プロジェクト「baskettalkjapan」を選択
3. 左メニューから「請求」を選択

### ステップ2: 予算を作成

1. 「予算とアラート」を選択
2. 「予算を作成」をクリック

### ステップ3: 予算の基本設定

1. **予算名**: 「Firestore 予算」など、わかりやすい名前を入力
2. **予算額**: 
   - 推奨: **$0.5/月** または **$1/月**
   - 無料枠内で使用する場合は、$0.5/月で十分です
3. **予算期間**: 「月次」を選択
4. **予算の範囲**: 「すべてのプロジェクト」または「baskettalkjapan」を選択

### ステップ4: アラートの設定（重要）

**予算に近づいた時点で通知を受け取る設定：**

1. 「アラートの設定」セクションで以下を設定：
   - **50%**: 予算の50%に達した時点で通知
   - **90%**: 予算の90%に達した時点で通知
   - **100%**: 予算の100%に達した時点で通知

2. **通知先のメールアドレス**を入力（複数可）

3. 「アラートを追加」をクリック

### ステップ5: 使用量制限の設定（最も安全）

**予算を超えた時点で自動的にサービスを停止する設定：**

⚠️ **この設定を有効にすると、予算を超えた時点でサービスが自動的に停止します。**

1. 「予算を超えたらすべてのプロジェクトを無効にする」のチェックボックスを**有効化**
2. これにより、予算を超えた時点で：
   - サービスが自動的に停止
   - それ以上の課金が発生しない

### ステップ6: 予算の作成

1. すべての設定を確認
2. 「作成」をクリック
3. 予算が作成されました

## 課金を防ぐための対策

### 1. 予算アラートの設定（推奨：必須）

**予算アラートを設定すると、予算に近づいた時点でメール通知を受け取れます。**

詳細は上記の「予算アラート・使用量制限の設定」を参照してください。

### 2. 使用量制限の設定（最も安全）

**使用量制限を設定すると、予算を超えた時点で自動的にサービスが停止します。**

詳細は上記の「予算アラート・使用量制限の設定」を参照してください。

### 3. 使用量の監視

Firebase Consoleで使用量を確認できます：

1. [Firebase Console](https://console.firebase.google.com/)にアクセス
2. プロジェクト「baskettalkjapan」を選択
3. 左メニューの⚙️アイコン > 「プロジェクトの設定」をクリック
4. 「使用量と請求」タブを選択
5. 各サービスの使用量を確認

**推奨**: 週1回程度、使用量を確認してください。

### 4. 開発環境での注意点

開発中は以下の点に注意：

- **大量のテストデータを作成しない**
- **無限ループでデータを読み書きしない**
- **定期的に使用量を確認する**

### 安全に使用するためのチェックリスト

**必ず設定してください：**

- [ ] **予算アラートを設定**（$0.5-1/月程度）⭐ **必須**
- [ ] **使用量制限を設定**（予算を超えたら自動停止）⭐ **推奨**
- [ ] Firebase Consoleで使用量を定期的に確認（週1回程度）
- [ ] 開発環境では大量のテストデータを作成しない
- [ ] 本番環境では使用量を監視する
- [ ] 不要なデータは定期的に削除する

## よくある質問

### Q: 請求先情報を登録したら、すぐに課金されますか？

**A: いいえ。** 無料枠内であれば一切課金されません。無料枠を超えた場合のみ課金されます。

### Q: 無料枠を超えたら自動的に課金されますか？

**A: はい。** 無料枠を超えた場合、自動的に課金されます。

**対策：**
- **予算アラートを設定**: 予算に近づいた時点でメール通知を受け取れます
- **使用量制限を設定**: 予算を超えた時点で自動的にサービスを停止できます（これにより、予想外の課金を完全に防げます）

### Q: 予算を超えたら自動的にサービスが停止しますか？

**A: 設定次第です。** 

- **予算アラートのみ設定**: 通知のみ受け取り、サービスは継続（課金は継続）
- **使用量制限も設定**: 予算を超えた時点で自動的にサービスが停止（課金を完全に防げます）

**推奨**: 使用量制限を設定することで、予想外の課金を完全に防げます。

### Q: 以前は請求先情報なしで使えていたのに、なぜ今は必要ですか？

**A:** Google Cloudのポリシー変更により、2020年以降、Firestore Databaseを作成する際に請求先情報の登録が必須になりました。これは、予想外の課金を防ぎ、サービス利用の透明性を高めるためです。

### Q: 開発中に無料枠を超える可能性はありますか？

**A: 通常はありません。** ただし、以下のような場合に注意が必要です：
- 大量のテストデータを作成した場合
- 無限ループでデータを読み書きした場合
- バグで大量のリクエストが発生した場合

### Q: 無料枠を超えた場合、どのくらいの費用がかかりますか？

**A: 使用量によります。** 一般的な小規模サイトでは、月額$1-5程度です。

## 📚 参考リンク

- [Firebase 料金](https://firebase.google.com/pricing?hl=ja)
- [Firestore 料金詳細](https://firebase.google.com/docs/firestore/pricing)
- [Google Cloud 予算とアラート](https://cloud.google.com/billing/docs/how-to/budgets)
- [Google Cloud 請求の有効化](https://cloud.google.com/billing/docs/how-to/modify-project)

## 💡 まとめ

- ✅ **無料枠内であれば一切課金されません**
- ✅ **開発・テスト段階では通常無料枠で十分です**
- ✅ **予算アラートを設定すれば、事前に通知を受け取れます**
- ✅ **使用量を定期的に確認すれば、安心して使用できます**

請求先情報を登録しても、無料枠内であれば**一切課金されません**。安心して使用してください。

