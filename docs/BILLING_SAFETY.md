# Firebase 課金について - 安全に使用する方法

## ✅ 重要なポイント

**無料枠内であれば、一切課金されません。**

Firebase（Firestore）には**Spark プラン（無料プラン）**があり、開発・テスト段階では通常この無料枠で十分です。

## 📊 Firestore 無料枠の詳細

### 無料枠の範囲

| 項目 | 無料枠 | 説明 |
|------|--------|------|
| **ストレージ** | 1GB | データベースに保存できるデータ量 |
| **読み取り** | 50,000回/日 | データを読み取る回数 |
| **書き込み** | 20,000回/日 | データを書き込む回数 |
| **削除** | 20,000回/日 | データを削除する回数 |
| **ネットワーク送信** | 10GB/月 | データ転送量 |

### 無料枠の例

**開発・テスト段階での一般的な使用量：**

- ユーザー数: 100人程度
- スレッド数: 1,000件程度
- 投稿数: 10,000件程度
- 1日の読み取り: 数千回程度

→ **無料枠内で十分です**

## 💰 課金が発生する場合

### ⚠️ 無料枠を超えた場合、自動的に課金されます

**重要な注意点：**
- 無料枠を超えた場合、**自動的に課金されます**
- 事前の通知なしに課金される可能性があります
- ただし、**予算アラートや使用量制限を設定することで、事前に通知を受け取ったり、自動的に停止させることができます**

### 無料枠を超えた場合の課金

無料枠を超えた部分に対してのみ、従量課金が発生します：

| 項目 | 料金 |
|------|------|
| ストレージ | $0.18/GB/月（1GB超えた分） |
| 読み取り | $0.06/100,000回（50,000回/日超えた分） |
| 書き込み | $0.18/100,000回（20,000回/日超えた分） |

**例：**
- ストレージが1.5GBの場合: (1.5 - 1.0) × $0.18 = **$0.09/月**
- 1日に60,000回読み取った場合: (60,000 - 50,000) / 100,000 × $0.06 = **$0.006/日**

### 課金が発生しやすいケース

⚠️ **以下のような大規模な使用でない限り、無料枠内です：**

- ユーザー数が数万人を超える
- 1日に数万回以上の読み取りが発生する
- データベースのサイズが1GBを超える
- 大量のデータを一括でアップロードする

## 🛡️ 課金を防ぐための対策（重要）

### ⚠️ 必ず設定してください

無料枠を超えた場合、自動的に課金されるため、以下の対策を**必ず設定してください**。

### 1. 予算アラートの設定（推奨：必須）

**予算アラートを設定すると、予算に近づいた時点でメール通知を受け取れます。**

手順：

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. プロジェクト「baskettalkjapan」を選択
3. 左メニューから「請求」>「予算とアラート」を選択
4. 「予算を作成」をクリック
5. 予算の設定：
   - **予算名**: 「Firestore 予算」など
   - **予算額**: $1/月（または$0.5/月）を推奨
   - **予算期間**: 月次
6. **アラートの設定**（重要）：
   - 予算の50%で通知
   - 予算の90%で通知
   - 予算の100%で通知
7. 「作成」をクリック

これで、予算に近づいた時点でメール通知を受け取れます。

### 2. 使用量制限の設定（最も安全）

**使用量制限を設定すると、予算を超えた時点で自動的にサービスが停止します。**

手順：

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. プロジェクト「baskettalkjapan」を選択
3. 左メニューから「請求」>「予算とアラート」を選択
4. 予算を作成（上記の手順1を参照）
5. **「予算を超えたらすべてのプロジェクトを無効にする」を有効化**
   - ⚠️ **注意**: この設定を有効にすると、予算を超えた時点で**サービスが自動的に停止**します
   - これにより、予想外の課金を完全に防げます

### 3. 使用量の監視

Firebase Consoleで使用量を確認できます：

1. [Firebase Console](https://console.firebase.google.com/)にアクセス
2. プロジェクト「baskettalkjapan」を選択
3. 左メニューの⚙️アイコン > 「プロジェクトの設定」をクリック
4. 「使用量と請求」タブを選択
5. 各サービスの使用量を確認

**推奨**: 週1回程度、使用量を確認してください。

### 4. 開発環境での注意点

開発中は以下の点に注意：

- **大量のテストデータを作成しない**
- **無限ループでデータを読み書きしない**
- **定期的に使用量を確認する**

## 📈 使用量の見積もり

### 一般的な使用量の目安

**小規模なコミュニティサイト（ユーザー数: 100-1,000人）:**

- ストレージ: 100-500MB（無料枠内）
- 読み取り: 5,000-20,000回/日（無料枠内）
- 書き込み: 1,000-5,000回/日（無料枠内）

→ **完全に無料枠内**

**中規模なコミュニティサイト（ユーザー数: 1,000-10,000人）:**

- ストレージ: 500MB-1GB（無料枠内）
- 読み取り: 20,000-50,000回/日（無料枠内）
- 書き込み: 5,000-20,000回/日（無料枠内）

→ **無料枠内またはわずかに超過（数ドル/月程度）**

## 🔒 安全に使用するためのチェックリスト

**必ず設定してください：**

- [ ] **予算アラートを設定**（$0.5-1/月程度）⭐ **必須**
- [ ] **使用量制限を設定**（予算を超えたら自動停止）⭐ **推奨**
- [ ] Firebase Consoleで使用量を定期的に確認（週1回程度）
- [ ] 開発環境では大量のテストデータを作成しない
- [ ] 本番環境では使用量を監視する
- [ ] 不要なデータは定期的に削除する

**特に重要な設定：**
1. **予算アラート**: 予算に近づいた時点で通知を受け取る
2. **使用量制限**: 予算を超えた時点で自動的にサービスを停止（予想外の課金を完全に防げます）

## ❓ よくある質問

### Q: 請求先情報を登録したら、すぐに課金されますか？

**A: いいえ。** 無料枠内であれば一切課金されません。無料枠を超えた場合のみ課金されます。

### Q: 無料枠を超えたら自動的に課金されますか？

**A: はい。** 無料枠を超えた場合、自動的に課金されます。

**対策：**
- **予算アラートを設定**: 予算に近づいた時点でメール通知を受け取れます
- **使用量制限を設定**: 予算を超えた時点で自動的にサービスを停止できます（これにより、予想外の課金を完全に防げます）

### Q: 予算を超えたら自動的にサービスが停止しますか？

**A: 設定次第です。** 

- **予算アラートのみ設定**: 通知のみ受け取り、サービスは継続（課金は継続）
- **使用量制限も設定**: 予算を超えた時点で自動的にサービスが停止（課金を完全に防げます）

**推奨**: 使用量制限を設定することで、予想外の課金を完全に防げます。

### Q: 開発中に無料枠を超える可能性はありますか？

**A: 通常はありません。** ただし、以下のような場合に注意が必要です：
- 大量のテストデータを作成した場合
- 無限ループでデータを読み書きした場合
- バグで大量のリクエストが発生した場合

### Q: 無料枠を超えた場合、どのくらいの費用がかかりますか？

**A: 使用量によります。** 一般的な小規模サイトでは、月額$1-5程度です。

## 📚 参考リンク

- [予算アラート・使用量制限の設定ガイド](BUDGET_SETUP_GUIDE.md) ⭐ **必読**
- [Firebase 料金](https://firebase.google.com/pricing?hl=ja)
- [Firestore 料金詳細](https://firebase.google.com/docs/firestore/pricing)
- [Google Cloud 予算とアラート](https://cloud.google.com/billing/docs/how-to/budgets)

## 💡 まとめ

- ✅ **無料枠内であれば一切課金されません**
- ✅ **開発・テスト段階では通常無料枠で十分です**
- ✅ **予算アラートを設定すれば、事前に通知を受け取れます**
- ✅ **使用量を定期的に確認すれば、安心して使用できます**

請求先情報を登録しても、無料枠内であれば**一切課金されません**。安心して使用してください。

